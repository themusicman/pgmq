
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../types/">
      
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Functions - PGMQ</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#functions" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="PGMQ" class="md-header__button md-logo" aria-label="PGMQ" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PGMQ
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Functions
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="indigo"  aria-label="dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="indigo"  aria-label="light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="PGMQ" class="md-nav__button md-logo" aria-label="PGMQ" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    PGMQ
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PGMQ
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    API
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    API
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" checked>
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    SQL
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    SQL
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Types
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Functions
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Functions
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sending-messages" class="md-nav__link">
    <span class="md-ellipsis">
      
        Sending Messages
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sending Messages">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#send" class="md-nav__link">
    <span class="md-ellipsis">
      
        send
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#send_batch" class="md-nav__link">
    <span class="md-ellipsis">
      
        send_batch
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reading-messages" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reading Messages
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Reading Messages">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#read" class="md-nav__link">
    <span class="md-ellipsis">
      
        read
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read_with_poll" class="md-nav__link">
    <span class="md-ellipsis">
      
        read_with_poll
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read_grouped" class="md-nav__link">
    <span class="md-ellipsis">
      
        read_grouped
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read_grouped_with_poll" class="md-nav__link">
    <span class="md-ellipsis">
      
        read_grouped_with_poll
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read_grouped_rr" class="md-nav__link">
    <span class="md-ellipsis">
      
        read_grouped_rr
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read_grouped_rr_with_poll" class="md-nav__link">
    <span class="md-ellipsis">
      
        read_grouped_rr_with_poll
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pop" class="md-nav__link">
    <span class="md-ellipsis">
      
        pop
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deletingarchiving-messages" class="md-nav__link">
    <span class="md-ellipsis">
      
        Deleting/Archiving Messages
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deleting/Archiving Messages">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delete-single" class="md-nav__link">
    <span class="md-ellipsis">
      
        delete (single)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-batch" class="md-nav__link">
    <span class="md-ellipsis">
      
        delete (batch)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#purge_queue" class="md-nav__link">
    <span class="md-ellipsis">
      
        purge_queue
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#archive-single" class="md-nav__link">
    <span class="md-ellipsis">
      
        archive (single)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#archive-batch" class="md-nav__link">
    <span class="md-ellipsis">
      
        archive (batch)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#queue-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        Queue Management
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Queue Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create" class="md-nav__link">
    <span class="md-ellipsis">
      
        create
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create_non_partitioned" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_non_partitioned
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create_partitioned" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_partitioned
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create_unlogged" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_unlogged
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#convert_archive_partitioned" class="md-nav__link">
    <span class="md-ellipsis">
      
        convert_archive_partitioned
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detach_archive" class="md-nav__link">
    <span class="md-ellipsis">
      
        detach_archive
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#drop_queue" class="md-nav__link">
    <span class="md-ellipsis">
      
        drop_queue
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utilities" class="md-nav__link">
    <span class="md-ellipsis">
      
        Utilities
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Utilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#set_vt-single" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_vt (single)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set_vt-batch" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_vt (batch)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#list_queues" class="md-nav__link">
    <span class="md-ellipsis">
      
        list_queues
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        metrics
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metrics_all" class="md-nav__link">
    <span class="md-ellipsis">
      
        metrics_all
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable_notify_insert" class="md-nav__link">
    <span class="md-ellipsis">
      
        enable_notify_insert
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disable_notify_insert" class="md-nav__link">
    <span class="md-ellipsis">
      
        disable_notify_insert
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create_fifo_index" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_fifo_index
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create_fifo_indexes_all" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_fifo_indexes_all
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sending-messages" class="md-nav__link">
    <span class="md-ellipsis">
      
        Sending Messages
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sending Messages">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#send" class="md-nav__link">
    <span class="md-ellipsis">
      
        send
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#send_batch" class="md-nav__link">
    <span class="md-ellipsis">
      
        send_batch
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reading-messages" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reading Messages
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Reading Messages">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#read" class="md-nav__link">
    <span class="md-ellipsis">
      
        read
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read_with_poll" class="md-nav__link">
    <span class="md-ellipsis">
      
        read_with_poll
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read_grouped" class="md-nav__link">
    <span class="md-ellipsis">
      
        read_grouped
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read_grouped_with_poll" class="md-nav__link">
    <span class="md-ellipsis">
      
        read_grouped_with_poll
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read_grouped_rr" class="md-nav__link">
    <span class="md-ellipsis">
      
        read_grouped_rr
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read_grouped_rr_with_poll" class="md-nav__link">
    <span class="md-ellipsis">
      
        read_grouped_rr_with_poll
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pop" class="md-nav__link">
    <span class="md-ellipsis">
      
        pop
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deletingarchiving-messages" class="md-nav__link">
    <span class="md-ellipsis">
      
        Deleting/Archiving Messages
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deleting/Archiving Messages">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delete-single" class="md-nav__link">
    <span class="md-ellipsis">
      
        delete (single)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-batch" class="md-nav__link">
    <span class="md-ellipsis">
      
        delete (batch)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#purge_queue" class="md-nav__link">
    <span class="md-ellipsis">
      
        purge_queue
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#archive-single" class="md-nav__link">
    <span class="md-ellipsis">
      
        archive (single)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#archive-batch" class="md-nav__link">
    <span class="md-ellipsis">
      
        archive (batch)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#queue-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        Queue Management
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Queue Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create" class="md-nav__link">
    <span class="md-ellipsis">
      
        create
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create_non_partitioned" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_non_partitioned
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create_partitioned" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_partitioned
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create_unlogged" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_unlogged
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#convert_archive_partitioned" class="md-nav__link">
    <span class="md-ellipsis">
      
        convert_archive_partitioned
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detach_archive" class="md-nav__link">
    <span class="md-ellipsis">
      
        detach_archive
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#drop_queue" class="md-nav__link">
    <span class="md-ellipsis">
      
        drop_queue
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utilities" class="md-nav__link">
    <span class="md-ellipsis">
      
        Utilities
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Utilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#set_vt-single" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_vt (single)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set_vt-batch" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_vt (batch)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#list_queues" class="md-nav__link">
    <span class="md-ellipsis">
      
        list_queues
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        metrics
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metrics_all" class="md-nav__link">
    <span class="md-ellipsis">
      
        metrics_all
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable_notify_insert" class="md-nav__link">
    <span class="md-ellipsis">
      
        enable_notify_insert
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disable_notify_insert" class="md-nav__link">
    <span class="md-ellipsis">
      
        disable_notify_insert
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create_fifo_index" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_fifo_index
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create_fifo_indexes_all" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_fifo_indexes_all
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="functions">Functions<a class="headerlink" href="#functions" title="Permanent link">&para;</a></h1>
<h2 id="sending-messages">Sending Messages<a class="headerlink" href="#sending-messages" title="Permanent link">&para;</a></h2>
<h3 id="send">send<a class="headerlink" href="#send" title="Permanent link">&para;</a></h3>
<p>Send a single message to a queue with optional headers and delay.</p>
<p><strong>Signatures:</strong></p>
<div class="codehilite"><pre><span></span><code>pgmq.send(queue_name text, msg jsonb)
pgmq.send(queue_name text, msg jsonb, headers jsonb)
pgmq.send(queue_name text, msg jsonb, delay integer)
pgmq.send(queue_name text, msg jsonb, delay timestamp with time zone)
pgmq.send(queue_name text, msg jsonb, headers jsonb, delay integer)
pgmq.send(queue_name text, msg jsonb, headers jsonb, delay timestamp with time zone)

RETURNS SETOF bigint
</code></pre></div>

<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">queue_name</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">The name of the queue</td>
</tr>
<tr>
<td style="text-align: left;">msg</td>
<td style="text-align: left;">jsonb</td>
<td style="text-align: left;">The message to send to the queue</td>
</tr>
<tr>
<td style="text-align: left;">headers</td>
<td style="text-align: left;">jsonb</td>
<td style="text-align: left;">Optional message headers/metadata</td>
</tr>
<tr>
<td style="text-align: left;">delay</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">Time in seconds before the message becomes visible</td>
</tr>
<tr>
<td style="text-align: left;">delay</td>
<td style="text-align: left;">timestamp with time zone</td>
<td style="text-align: left;">Timestamp when the message becomes visible</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong> The ID of the message that was added to the queue.</p>
<p>Examples:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">-- Send a message</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&quot;hello&quot;: &quot;world&quot;}&#39;</span><span class="p">);</span>
<span class="w"> </span><span class="n">send</span>
<span class="c1">------</span>
<span class="w">    </span><span class="mi">1</span>

<span class="c1">-- Send a message with headers</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&quot;hello&quot;: &quot;world&quot;}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&quot;trace_id&quot;: &quot;abc123&quot;}&#39;</span><span class="p">);</span>
<span class="w"> </span><span class="n">send</span>
<span class="c1">------</span>
<span class="w">    </span><span class="mi">2</span>

<span class="c1">-- Message with a delay of 5 seconds</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&quot;hello&quot;: &quot;world&quot;}&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span>
<span class="w"> </span><span class="n">send</span>
<span class="c1">------</span>
<span class="w">    </span><span class="mi">3</span>

<span class="c1">-- Message readable from tomorrow</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&quot;hello&quot;: &quot;world&quot;}&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="s1">&#39;1 day&#39;</span><span class="p">);</span>
<span class="w"> </span><span class="n">send</span>
<span class="c1">------</span>
<span class="w">    </span><span class="mi">4</span>

<span class="c1">-- Message with headers and delay</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&quot;hello&quot;: &quot;world&quot;}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&quot;priority&quot;: &quot;high&quot;}&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>
<span class="w"> </span><span class="n">send</span>
<span class="c1">------</span>
<span class="w">    </span><span class="mi">5</span>
</code></pre></div>

<hr />
<h3 id="send_batch">send_batch<a class="headerlink" href="#send_batch" title="Permanent link">&para;</a></h3>
<p>Send 1 or more messages to a queue with optional headers and delay.</p>
<p><strong>Signatures:</strong></p>
<div class="codehilite"><pre><span></span><code>pgmq.send_batch(queue_name text, msgs jsonb[])
pgmq.send_batch(queue_name text, msgs jsonb[], headers jsonb[])
pgmq.send_batch(queue_name text, msgs jsonb[], delay integer)
pgmq.send_batch(queue_name text, msgs jsonb[], delay timestamp with time zone)
pgmq.send_batch(queue_name text, msgs jsonb[], headers jsonb[], delay integer)
pgmq.send_batch(queue_name text, msgs jsonb[], headers jsonb[], delay timestamp with time zone)

RETURNS SETOF bigint
</code></pre></div>

<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">queue_name</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">The name of the queue</td>
</tr>
<tr>
<td style="text-align: left;">msgs</td>
<td style="text-align: left;">jsonb[]</td>
<td style="text-align: left;">Array of messages to send to the queue</td>
</tr>
<tr>
<td style="text-align: left;">headers</td>
<td style="text-align: left;">jsonb[]</td>
<td style="text-align: left;">Array of headers for each message (must match msgs length, or can be omitted)</td>
</tr>
<tr>
<td style="text-align: left;">delay</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">Time in seconds before the messages become visible</td>
</tr>
<tr>
<td style="text-align: left;">delay</td>
<td style="text-align: left;">timestamp with time zone</td>
<td style="text-align: left;">Timestamp when the messages become visible</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong> The IDs of the messages that were added to the queue.</p>
<p>Examples:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">-- Send multiple messages</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">send_batch</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nb">ARRAY</span><span class="p">[</span>
<span class="w">        </span><span class="s1">&#39;{&quot;hello&quot;: &quot;world_0&quot;}&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;{&quot;hello&quot;: &quot;world_1&quot;}&#39;</span>
<span class="w">    </span><span class="p">]::</span><span class="n">jsonb</span><span class="p">[]</span>
<span class="p">);</span>
<span class="w"> </span><span class="n">send_batch</span>
<span class="c1">------------</span>
<span class="w">          </span><span class="mi">1</span>
<span class="w">          </span><span class="mi">2</span>

<span class="c1">-- Send with headers for each message</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">send_batch</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nb">ARRAY</span><span class="p">[</span><span class="s1">&#39;{&quot;hello&quot;: &quot;world_0&quot;}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&quot;hello&quot;: &quot;world_1&quot;}&#39;</span><span class="p">]::</span><span class="n">jsonb</span><span class="p">[],</span>
<span class="w">    </span><span class="nb">ARRAY</span><span class="p">[</span><span class="s1">&#39;{&quot;trace_id&quot;: &quot;abc&quot;}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&quot;trace_id&quot;: &quot;def&quot;}&#39;</span><span class="p">]::</span><span class="n">jsonb</span><span class="p">[]</span>
<span class="p">);</span>
<span class="w"> </span><span class="n">send_batch</span>
<span class="c1">------------</span>
<span class="w">          </span><span class="mi">3</span>
<span class="w">          </span><span class="mi">4</span>

<span class="c1">-- Messages with a delay of 5 seconds</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">send_batch</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nb">ARRAY</span><span class="p">[</span>
<span class="w">        </span><span class="s1">&#39;{&quot;hello&quot;: &quot;world_0&quot;}&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;{&quot;hello&quot;: &quot;world_1&quot;}&#39;</span>
<span class="w">    </span><span class="p">]::</span><span class="n">jsonb</span><span class="p">[],</span>
<span class="w">    </span><span class="mi">5</span>
<span class="p">);</span>
<span class="w"> </span><span class="n">send_batch</span>
<span class="c1">------------</span>
<span class="w">          </span><span class="mi">5</span>
<span class="w">          </span><span class="mi">6</span>

<span class="c1">-- Messages readable from tomorrow</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">send_batch</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nb">ARRAY</span><span class="p">[</span>
<span class="w">        </span><span class="s1">&#39;{&quot;hello&quot;: &quot;world_0&quot;}&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;{&quot;hello&quot;: &quot;world_1&quot;}&#39;</span>
<span class="w">    </span><span class="p">]::</span><span class="n">jsonb</span><span class="p">[],</span>
<span class="w">    </span><span class="k">CURRENT_TIMESTAMP</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="s1">&#39;1 day&#39;</span>
<span class="p">);</span>
<span class="w"> </span><span class="n">send_batch</span>
<span class="c1">------------</span>
<span class="w">          </span><span class="mi">7</span>
<span class="w">          </span><span class="mi">8</span>
</code></pre></div>

<hr />
<h2 id="reading-messages">Reading Messages<a class="headerlink" href="#reading-messages" title="Permanent link">&para;</a></h2>
<h3 id="read">read<a class="headerlink" href="#read" title="Permanent link">&para;</a></h3>
<p>Read 1 or more messages from a queue. The VT specifies the amount of time in seconds that the message will be invisible to other consumers after reading.</p>
<pre>
 <code>
pgmq.read(
    queue_name text,
    vt integer,
    qty integer,
    conditional jsonb DEFAULT '{}')

RETURNS SETOF <a href="../types/#message_record">pgmq.message_record</a>
 </code>
</pre>

<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">queue_name</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">The name of the queue</td>
</tr>
<tr>
<td style="text-align: left;">vt</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">Time in seconds that the message become invisible after reading</td>
</tr>
<tr>
<td style="text-align: left;">qty</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">The number of messages to read from the queue</td>
</tr>
<tr>
<td style="text-align: left;">conditional</td>
<td style="text-align: left;">jsonb</td>
<td style="text-align: left;">Filters the messages by their json content. Defaults to '{}' - no filtering. <strong>This feature is experimental, and the API is subject to change in future releases</strong></td>
</tr>
</tbody>
</table>
<p>Examples:</p>
<p>Read messages from a queue</p>
<div class="codehilite"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="k">read</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w"> </span><span class="n">msg_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">read_ct</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="n">enqueued_at</span><span class="w">          </span><span class="o">|</span><span class="w">              </span><span class="n">vt</span><span class="w">               </span><span class="o">|</span><span class="w">       </span><span class="n">message</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">headers</span>
<span class="c1">--------+---------+-------------------------------+-------------------------------+----------------------+---------</span>
<span class="w">      </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="w"> </span><span class="mi">19</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mi">47</span><span class="p">.</span><span class="mi">356595</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="w"> </span><span class="mi">19</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mi">08</span><span class="p">.</span><span class="mi">608922</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;hello&quot;</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;world_0&quot;</span><span class="err">}</span><span class="w"> </span><span class="o">|</span>
<span class="w">      </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="w"> </span><span class="mi">19</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mi">47</span><span class="p">.</span><span class="mi">356595</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="w"> </span><span class="mi">19</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mi">08</span><span class="p">.</span><span class="mi">608974</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;hello&quot;</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;world_1&quot;</span><span class="err">}</span><span class="w"> </span><span class="o">|</span>
<span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="k">rows</span><span class="p">)</span>
</code></pre></div>

<p>Read a message from a queue with message filtering</p>
<div class="codehilite"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="k">read</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&quot;hello&quot;: &quot;world_1&quot;}&#39;</span><span class="p">);</span>
<span class="w"> </span><span class="n">msg_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">read_ct</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="n">enqueued_at</span><span class="w">          </span><span class="o">|</span><span class="w">              </span><span class="n">vt</span><span class="w">               </span><span class="o">|</span><span class="w">       </span><span class="n">message</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">headers</span>
<span class="c1">--------+---------+-------------------------------+-------------------------------+----------------------+---------</span>
<span class="w">      </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="w"> </span><span class="mi">19</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mi">47</span><span class="p">.</span><span class="mi">356595</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="w"> </span><span class="mi">19</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mi">08</span><span class="p">.</span><span class="mi">608974</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;hello&quot;</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;world_1&quot;</span><span class="err">}</span><span class="w"> </span><span class="o">|</span>
<span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="p">)</span>
</code></pre></div>

<hr />
<h3 id="read_with_poll">read_with_poll<a class="headerlink" href="#read_with_poll" title="Permanent link">&para;</a></h3>
<p>Same as read(). Also provides convenient long-poll functionality.
 When there are no messages in the queue, the function call will wait for <code>max_poll_seconds</code> in duration before returning.
 If messages reach the queue during that duration, they will be read and returned immediately.</p>
<pre>
 <code>
 pgmq.read_with_poll(
    queue_name text,
    vt integer,
    qty integer,
    max_poll_seconds integer DEFAULT 5,
    poll_interval_ms integer DEFAULT 100,
    conditional jsonb DEFAULT '{}'
)
RETURNS SETOF <a href="../types/#message_record">pgmq.message_record</a>
 </code>
</pre>

<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">queue_name</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">The name of the queue</td>
</tr>
<tr>
<td style="text-align: left;">vt</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">Time in seconds that the message become invisible after reading.</td>
</tr>
<tr>
<td style="text-align: left;">qty</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">The number of messages to read from the queue</td>
</tr>
<tr>
<td style="text-align: left;">max_poll_seconds</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">Time in seconds to wait for new messages to reach the queue. Defaults to 5.</td>
</tr>
<tr>
<td style="text-align: left;">poll_interval_ms</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">Milliseconds between the internal poll operations. Defaults to 100.</td>
</tr>
<tr>
<td style="text-align: left;">conditional</td>
<td style="text-align: left;">jsonb</td>
<td style="text-align: left;">Filters the messages by their json content. Defaults to '{}' - no filtering. <strong>This feature is experimental, and the API is subject to change in future releases</strong></td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="codehilite"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">read_with_poll</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">);</span>
<span class="w"> </span><span class="n">msg_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">read_ct</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="n">enqueued_at</span><span class="w">          </span><span class="o">|</span><span class="w">              </span><span class="n">vt</span><span class="w">               </span><span class="o">|</span><span class="w">      </span><span class="n">message</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">headers</span>
<span class="c1">--------+---------+-------------------------------+-------------------------------+--------------------+---------</span>
<span class="w">      </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="w"> </span><span class="mi">19</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">09</span><span class="p">.</span><span class="mi">177756</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="w"> </span><span class="mi">19</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">00</span><span class="p">.</span><span class="mi">337929</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;hello&quot;</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;world&quot;</span><span class="err">}</span><span class="w"> </span><span class="o">|</span>
</code></pre></div>

<hr />
<h3 id="read_grouped">read_grouped<a class="headerlink" href="#read_grouped" title="Permanent link">&para;</a></h3>
<p>Read messages from a queue with AWS SQS FIFO-style batch retrieval behavior. This function attempts to return as many messages as possible from the same message group, filling the batch from the earliest available group first. Messages with the same FIFO group ID (specified in the <code>x-pgmq-group</code> header) will be processed in order. Messages without FIFO headers are treated as belonging to a default group.</p>
<pre>
 <code>
pgmq.read_grouped(
    queue_name text,
    vt integer,
    qty integer
)
RETURNS SETOF <a href="../types/#message_record">pgmq.message_record</a>
 </code>
</pre>

<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">queue_name</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">The name of the queue</td>
</tr>
<tr>
<td style="text-align: left;">vt</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">Time in seconds that the message become invisible after reading</td>
</tr>
<tr>
<td style="text-align: left;">qty</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">The number of messages to read from the queue</td>
</tr>
</tbody>
</table>
<p><strong>FIFO Behavior (Fill from same group):</strong>
- Messages with the same <code>x-pgmq-group</code> header value are processed in strict order
- Only the oldest unprocessed message from each FIFO group can be read
- The batch is filled preferentially from the earliest group (by oldest msg_id)
- Messages from different FIFO groups can be processed in parallel
- Messages without FIFO headers are treated as a single default group</p>
<p>Examples:</p>
<p>Send messages with FIFO grouping:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">-- Send messages to the same FIFO group</span>
<span class="k">select</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&quot;order&quot;: 1}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&quot;x-pgmq-group&quot;: &quot;user123&quot;}&#39;</span><span class="p">);</span>
<span class="k">select</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&quot;order&quot;: 2}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&quot;x-pgmq-group&quot;: &quot;user123&quot;}&#39;</span><span class="p">);</span>
<span class="k">select</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&quot;order&quot;: 3}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&quot;x-pgmq-group&quot;: &quot;user123&quot;}&#39;</span><span class="p">);</span>
<span class="k">select</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&quot;order&quot;: 1}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&quot;x-pgmq-group&quot;: &quot;user456&quot;}&#39;</span><span class="p">);</span>

<span class="c1">-- Read with FIFO grouped ordering - tries to fill batch from earliest group</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">read_grouped</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span>
<span class="w"> </span><span class="n">msg_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">read_ct</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="n">enqueued_at</span><span class="w">          </span><span class="o">|</span><span class="w">              </span><span class="n">vt</span><span class="w">               </span><span class="o">|</span><span class="w">     </span><span class="n">message</span><span class="w">     </span><span class="o">|</span><span class="w">           </span><span class="n">headers</span>
<span class="c1">--------+---------+-------------------------------+-------------------------------+-----------------+---------------------------</span>
<span class="w">      </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="w"> </span><span class="mi">19</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mi">47</span><span class="p">.</span><span class="mi">356595</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="w"> </span><span class="mi">19</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mi">08</span><span class="p">.</span><span class="mi">608922</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;order&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="err">}</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;x-pgmq-group&quot;</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;user123&quot;</span><span class="err">}</span>
<span class="w">      </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="w"> </span><span class="mi">19</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mi">47</span><span class="p">.</span><span class="mi">356595</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="w"> </span><span class="mi">19</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mi">08</span><span class="p">.</span><span class="mi">608974</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;order&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="err">}</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;x-pgmq-group&quot;</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;user123&quot;</span><span class="err">}</span>
<span class="w">      </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="w"> </span><span class="mi">19</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mi">47</span><span class="p">.</span><span class="mi">356595</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="w"> </span><span class="mi">19</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mi">08</span><span class="p">.</span><span class="mi">608974</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;order&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="err">}</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;x-pgmq-group&quot;</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;user123&quot;</span><span class="err">}</span>
</code></pre></div>

<hr />
<h3 id="read_grouped_with_poll">read_grouped_with_poll<a class="headerlink" href="#read_grouped_with_poll" title="Permanent link">&para;</a></h3>
<p>Same as read_grouped(). Also provides convenient long-poll functionality for FIFO queues.
 When there are no messages available that respect FIFO ordering, the function call will wait for <code>max_poll_seconds</code> in duration before returning.</p>
<pre>
 <code>
 pgmq.read_grouped_with_poll(
    queue_name text,
    vt integer,
    qty integer,
    max_poll_seconds integer DEFAULT 5,
    poll_interval_ms integer DEFAULT 100
)
RETURNS SETOF <a href="../types/#message_record">pgmq.message_record</a>
 </code>
</pre>

<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">queue_name</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">The name of the queue</td>
</tr>
<tr>
<td style="text-align: left;">vt</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">Time in seconds that the message become invisible after reading.</td>
</tr>
<tr>
<td style="text-align: left;">qty</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">The number of messages to read from the queue.</td>
</tr>
<tr>
<td style="text-align: left;">max_poll_seconds</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">Time in seconds to wait for new messages to reach the queue. Defaults to 5.</td>
</tr>
<tr>
<td style="text-align: left;">poll_interval_ms</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">Milliseconds between the internal poll operations. Defaults to 100.</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="codehilite"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">read_grouped_with_poll</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">);</span>
<span class="w"> </span><span class="n">msg_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">read_ct</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="n">enqueued_at</span><span class="w">          </span><span class="o">|</span><span class="w">              </span><span class="n">vt</span><span class="w">               </span><span class="o">|</span><span class="w">      </span><span class="n">message</span><span class="w">    </span><span class="o">|</span><span class="w">           </span><span class="n">headers</span>
<span class="c1">--------+---------+-------------------------------+-------------------------------+-----------------+---------------------------</span>
<span class="w">      </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="w"> </span><span class="mi">19</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">09</span><span class="p">.</span><span class="mi">177756</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="w"> </span><span class="mi">19</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">00</span><span class="p">.</span><span class="mi">337929</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;order&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="err">}</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;x-pgmq-group&quot;</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;user123&quot;</span><span class="err">}</span>
</code></pre></div>

<hr />
<h3 id="read_grouped_rr">read_grouped_rr<a class="headerlink" href="#read_grouped_rr" title="Permanent link">&para;</a></h3>
<p>Read messages from a queue while respecting FIFO (First-In-First-Out) ordering within message groups and using round-robin interleaving across groups. Messages with the same FIFO group ID (specified in the <code>x-pgmq-group</code> header) will be processed in strict order. Messages without FIFO headers are treated as belonging to a default group.</p>
<pre>
 <code>
pgmq.read_grouped_rr(
    queue_name text,
    vt integer,
    qty integer
)
RETURNS SETOF <a href="../types/#message_record">pgmq.message_record</a>
 </code>
</pre>

<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">queue_name</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">The name of the queue</td>
</tr>
<tr>
<td style="text-align: left;">vt</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">Time in seconds that the message become invisible after reading</td>
</tr>
<tr>
<td style="text-align: left;">qty</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">The number of messages to read from the queue</td>
</tr>
</tbody>
</table>
<p><strong>FIFO Behavior (Round Robin across groups):</strong>
- Messages with the same <code>x-pgmq-group</code> header value are processed in strict order
- Only the oldest unprocessed message from each FIFO group can be read
- Messages from different FIFO groups can be processed in parallel
- Messages without FIFO headers are treated as a single default group</p>
<p>Examples:</p>
<p>Send messages with FIFO grouping:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">-- Send messages to the same FIFO group</span>
<span class="k">select</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&quot;order&quot;: 1}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&quot;x-pgmq-group&quot;: &quot;user123&quot;}&#39;</span><span class="p">);</span>
<span class="k">select</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&quot;order&quot;: 2}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&quot;x-pgmq-group&quot;: &quot;user123&quot;}&#39;</span><span class="p">);</span>
<span class="k">select</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&quot;order&quot;: 1}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&quot;x-pgmq-group&quot;: &quot;user456&quot;}&#39;</span><span class="p">);</span>

<span class="c1">-- Read with FIFO RR ordering - interleaves by group layers</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">read_grouped_rr</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span>
<span class="w"> </span><span class="n">msg_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">read_ct</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="n">enqueued_at</span><span class="w">          </span><span class="o">|</span><span class="w">              </span><span class="n">vt</span><span class="w">               </span><span class="o">|</span><span class="w">     </span><span class="n">message</span><span class="w">     </span><span class="o">|</span><span class="w">           </span><span class="n">headers</span>
<span class="c1">--------+---------+-------------------------------+-------------------------------+-----------------+---------------------------</span>
<span class="w">      </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="w"> </span><span class="mi">19</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mi">47</span><span class="p">.</span><span class="mi">356595</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="w"> </span><span class="mi">19</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mi">08</span><span class="p">.</span><span class="mi">608922</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;order&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="err">}</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;x-pgmq-group&quot;</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;user123&quot;</span><span class="err">}</span>
<span class="w">      </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="w"> </span><span class="mi">19</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mi">47</span><span class="p">.</span><span class="mi">356595</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="w"> </span><span class="mi">19</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mi">08</span><span class="p">.</span><span class="mi">608974</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;order&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="err">}</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;x-pgmq-group&quot;</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;user456&quot;</span><span class="err">}</span>
</code></pre></div>

<hr />
<h3 id="read_grouped_rr_with_poll">read_grouped_rr_with_poll<a class="headerlink" href="#read_grouped_rr_with_poll" title="Permanent link">&para;</a></h3>
<p>Same as read_grouped_rr(). Also provides convenient long-poll functionality for FIFO queues.
 When there are no messages available that respect FIFO ordering, the function call will wait for <code>max_poll_seconds</code> in duration before returning.</p>
<pre>
 <code>
 pgmq.read_grouped_rr_with_poll(
    queue_name text,
    vt integer,
    qty integer,
    max_poll_seconds integer DEFAULT 5,
    poll_interval_ms integer DEFAULT 100
)
RETURNS SETOF <a href="../types/#message_record">pgmq.message_record</a>
 </code>
</pre>

<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">queue_name</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">The name of the queue</td>
</tr>
<tr>
<td style="text-align: left;">vt</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">Time in seconds that the message become invisible after reading.</td>
</tr>
<tr>
<td style="text-align: left;">qty</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">The number of messages to read from the queue.</td>
</tr>
<tr>
<td style="text-align: left;">max_poll_seconds</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">Time in seconds to wait for new messages to reach the queue. Defaults to 5.</td>
</tr>
<tr>
<td style="text-align: left;">poll_interval_ms</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">Milliseconds between the internal poll operations. Defaults to 100.</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="codehilite"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">read_grouped_rr_with_poll</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">);</span>
<span class="w"> </span><span class="n">msg_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">read_ct</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="n">enqueued_at</span><span class="w">          </span><span class="o">|</span><span class="w">              </span><span class="n">vt</span><span class="w">               </span><span class="o">|</span><span class="w">      </span><span class="n">message</span><span class="w">    </span><span class="o">|</span><span class="w">           </span><span class="n">headers</span>
<span class="c1">--------+---------+-------------------------------+-------------------------------+-----------------+---------------------------</span>
<span class="w">      </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="w"> </span><span class="mi">19</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">09</span><span class="p">.</span><span class="mi">177756</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="w"> </span><span class="mi">19</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">00</span><span class="p">.</span><span class="mi">337929</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;order&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="err">}</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;x-pgmq-group&quot;</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;user123&quot;</span><span class="err">}</span>
</code></pre></div>

<hr />
<h3 id="pop">pop<a class="headerlink" href="#pop" title="Permanent link">&para;</a></h3>
<p>Reads one or more messages from a queue and deletes them upon read.</p>
<p>Note: utilization of pop() results in at-most-once delivery semantics if the consuming application does not guarantee processing of the message.</p>
<pre>
 <code>
pgmq.pop(queue_name text, qty integer DEFAULT 1)
RETURNS SETOF <a href="../types/#message_record">pgmq.message_record</a>
 </code>
</pre>

<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">queue_name</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">The name of the queue</td>
</tr>
<tr>
<td style="text-align: left;">qty</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">The number of messages to pop from the queue. Defaults to 1.</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="codehilite"><pre><span></span><code><span class="n">pgmq</span><span class="o">=#</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">);</span>
<span class="w"> </span><span class="n">msg_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">read_ct</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="n">enqueued_at</span><span class="w">          </span><span class="o">|</span><span class="w">              </span><span class="n">vt</span><span class="w">               </span><span class="o">|</span><span class="w">      </span><span class="n">message</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">headers</span>
<span class="c1">--------+---------+-------------------------------+-------------------------------+--------------------+---------</span>
<span class="w">      </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="w"> </span><span class="mi">19</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">09</span><span class="p">.</span><span class="mi">177756</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="w"> </span><span class="mi">19</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">00</span><span class="p">.</span><span class="mi">337929</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;hello&quot;</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;world&quot;</span><span class="err">}</span><span class="w"> </span><span class="o">|</span>
</code></pre></div>

<hr />
<h2 id="deletingarchiving-messages">Deleting/Archiving Messages<a class="headerlink" href="#deletingarchiving-messages" title="Permanent link">&para;</a></h2>
<h3 id="delete-single">delete (single)<a class="headerlink" href="#delete-single" title="Permanent link">&para;</a></h3>
<p>Deletes a single message from a queue.</p>
<div class="codehilite"><pre><span></span><code>pgmq.delete (queue_name text, msg_id: bigint)
RETURNS boolean
</code></pre></div>

<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">queue_name</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">The name of the queue</td>
</tr>
<tr>
<td style="text-align: left;">msg_id</td>
<td style="text-align: left;">bigint</td>
<td style="text-align: left;">Message ID of the message to delete</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="codehilite"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span>
<span class="w"> </span><span class="k">delete</span>
<span class="c1">--------</span>
<span class="w"> </span><span class="n">t</span>
</code></pre></div>

<hr />
<h3 id="delete-batch">delete (batch)<a class="headerlink" href="#delete-batch" title="Permanent link">&para;</a></h3>
<p>Delete one or many messages from a queue.</p>
<div class="codehilite"><pre><span></span><code>pgmq.delete (queue_name text, msg_ids: bigint[])
RETURNS SETOF bigint
</code></pre></div>

<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">queue_name</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">The name of the queue</td>
</tr>
<tr>
<td style="text-align: left;">msg_ids</td>
<td style="text-align: left;">bigint[]</td>
<td style="text-align: left;">Array of message IDs to delete</td>
</tr>
</tbody>
</table>
<p>Examples:</p>
<p>Delete two messages that exist.</p>
<div class="codehilite"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">ARRAY</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">]);</span>
<span class="w"> </span><span class="k">delete</span>
<span class="c1">--------</span>
<span class="w">      </span><span class="mi">2</span>
<span class="w">      </span><span class="mi">3</span>
</code></pre></div>

<p>Delete two messages, one that exists and one that does not. Message <code>999</code> does not exist.</p>
<div class="codehilite"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">ARRAY</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">999</span><span class="p">]);</span>
<span class="w"> </span><span class="k">delete</span>
<span class="c1">--------</span>
<span class="w">      </span><span class="mi">6</span>
</code></pre></div>

<hr />
<h3 id="purge_queue">purge_queue<a class="headerlink" href="#purge_queue" title="Permanent link">&para;</a></h3>
<p>Permanently deletes all messages in a queue. Returns the number of messages that were deleted.</p>
<div class="codehilite"><pre><span></span><code>pgmq.purge_queue(queue_name text)
RETURNS bigint
</code></pre></div>

<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">queue_name</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">The name of the queue</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<p>Purge the queue when it contains 8 messages;</p>
<div class="codehilite"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">purge_queue</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">);</span>
<span class="w"> </span><span class="n">purge_queue</span>
<span class="c1">-------------</span>
<span class="w">           </span><span class="mi">8</span>
</code></pre></div>

<hr />
<h3 id="archive-single">archive (single)<a class="headerlink" href="#archive-single" title="Permanent link">&para;</a></h3>
<p>Removes a single requested message from the specified queue and inserts it into the queue's archive.</p>
<div class="codehilite"><pre><span></span><code>pgmq.archive(queue_name text, msg_id bigint)
RETURNS boolean
</code></pre></div>

<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">queue_name</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">The name of the queue</td>
</tr>
<tr>
<td style="text-align: left;">msg_id</td>
<td style="text-align: left;">bigint</td>
<td style="text-align: left;">Message ID of the message to archive</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong>
Boolean value indicating success or failure of the operation.</p>
<p><strong>Note:</strong> Archived messages are stored in the archive table with an additional <code>archived_at</code> timestamp field indicating when the message was archived.</p>
<p>Example; remove message with ID 1 from queue <code>my_queue</code> and archive it:</p>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">archive</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w"> </span><span class="n">archive</span>
<span class="c1">---------</span>
<span class="w">       </span><span class="n">t</span>
</code></pre></div>

<hr />
<h3 id="archive-batch">archive (batch)<a class="headerlink" href="#archive-batch" title="Permanent link">&para;</a></h3>
<p>Deletes a batch of requested messages from the specified queue and inserts them into the queue's archive.
 Returns an ARRAY of message ids that were successfully archived.</p>
<div class="codehilite"><pre><span></span><code>pgmq.archive(queue_name text, msg_ids bigint[])
RETURNS SETOF bigint
</code></pre></div>

<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">queue_name</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">The name of the queue</td>
</tr>
<tr>
<td style="text-align: left;">msg_ids</td>
<td style="text-align: left;">bigint[]</td>
<td style="text-align: left;">Array of message IDs to archive</td>
</tr>
</tbody>
</table>
<p>Examples:</p>
<p>Delete messages with ID 1 and 2 from queue <code>my_queue</code> and move to the archive.</p>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">archive</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">ARRAY</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">]);</span>
<span class="w"> </span><span class="n">archive</span>
<span class="c1">---------</span>
<span class="w">       </span><span class="mi">1</span>
<span class="w">       </span><span class="mi">2</span>
</code></pre></div>

<p>Delete messages 4, which exists and 999, which does not exist.</p>
<div class="codehilite"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">archive</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">ARRAY</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">999</span><span class="p">]);</span>
<span class="w"> </span><span class="n">archive</span>
<span class="c1">---------</span>
<span class="w">       </span><span class="mi">4</span>
</code></pre></div>

<hr />
<h2 id="queue-management">Queue Management<a class="headerlink" href="#queue-management" title="Permanent link">&para;</a></h2>
<h3 id="create">create<a class="headerlink" href="#create" title="Permanent link">&para;</a></h3>
<p>Create a new queue.</p>
<div class="codehilite"><pre><span></span><code>pgmq.create(queue_name text)
RETURNS VOID
</code></pre></div>

<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">queue_name</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">The name of the queue (max 47 characters)</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="codehilite"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="k">create</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">);</span>
<span class="w"> </span><span class="k">create</span>
<span class="c1">--------</span>
</code></pre></div>

<hr />
<h3 id="create_non_partitioned">create_non_partitioned<a class="headerlink" href="#create_non_partitioned" title="Permanent link">&para;</a></h3>
<p>Create a non-partitioned queue. This is the same as <code>create()</code>, but more explicit about the queue type.</p>
<div class="codehilite"><pre><span></span><code>pgmq.create_non_partitioned(queue_name text)
RETURNS void
</code></pre></div>

<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">queue_name</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">The name of the queue (max 47 characters)</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="codehilite"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">create_non_partitioned</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">);</span>
<span class="w"> </span><span class="n">create_non_partitioned</span>
<span class="c1">------------------------</span>
</code></pre></div>

<hr />
<h3 id="create_partitioned">create_partitioned<a class="headerlink" href="#create_partitioned" title="Permanent link">&para;</a></h3>
<p>Create a partitioned queue. Requires the <code>pg_partman</code> extension to be installed.</p>
<div class="codehilite"><pre><span></span><code>pgmq.create_partitioned (
    queue_name text,
    partition_interval text DEFAULT &#39;10000&#39;::text,
    retention_interval text DEFAULT &#39;100000&#39;::text
)
RETURNS void
</code></pre></div>

<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">queue_name</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">The name of the queue (max 47 characters)</td>
</tr>
<tr>
<td style="text-align: left;">partition_interval</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">Partition size - numeric value for msg_id-based partitioning (e.g., '10000'), or time interval for timestamp-based partitioning (e.g., '1 day'). Defaults to '10000'.</td>
</tr>
<tr>
<td style="text-align: left;">retention_interval</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">How long/how many messages to retain before deleting old partitions. Same format as partition_interval. Defaults to '100000'.</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<p>Create a queue with 100,000 messages per partition, and will retain 10,000,000 messages on old partitions. Partitions greater than this will be deleted.</p>
<div class="codehilite"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">create_partitioned</span><span class="p">(</span>
<span class="w">    </span><span class="s1">&#39;my_partitioned_queue&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;100000&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;10000000&#39;</span>
<span class="p">);</span>
<span class="w"> </span><span class="n">create_partitioned</span>
<span class="c1">--------------------</span>
</code></pre></div>

<hr />
<h3 id="create_unlogged">create_unlogged<a class="headerlink" href="#create_unlogged" title="Permanent link">&para;</a></h3>
<p>Creates an unlogged table. This is useful when write throughput is more important that durability.
See Postgres documentation for <a href="https://www.postgresql.org/docs/current/sql-createtable.html#SQL-CREATETABLE-UNLOGGED">unlogged tables</a> for more information.</p>
<div class="codehilite"><pre><span></span><code>pgmq.create_unlogged(queue_name text)
RETURNS void
</code></pre></div>

<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">queue_name</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">The name of the queue</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="codehilite"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">create_unlogged</span><span class="p">(</span><span class="s1">&#39;my_unlogged&#39;</span><span class="p">);</span>
<span class="w"> </span><span class="n">create_unlogged</span>
<span class="c1">-----------------</span>
</code></pre></div>

<hr />
<h3 id="convert_archive_partitioned">convert_archive_partitioned<a class="headerlink" href="#convert_archive_partitioned" title="Permanent link">&para;</a></h3>
<p>Convert an existing non-partitioned archive table to a partitioned one. Requires the <code>pg_partman</code> extension to be installed. This is useful for migrating queues to partitioned archives after they have been created.</p>
<div class="codehilite"><pre><span></span><code>pgmq.convert_archive_partitioned(
    table_name text,
    partition_interval text DEFAULT &#39;10000&#39;::text,
    retention_interval text DEFAULT &#39;100000&#39;::text,
    leading_partition integer DEFAULT 10
)
RETURNS void
</code></pre></div>

<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">table_name</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">The name of the queue whose archive should be partitioned</td>
</tr>
<tr>
<td style="text-align: left;">partition_interval</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">Partition size - numeric value for msg_id-based partitioning (e.g., '10000'), or time interval for timestamp-based partitioning (e.g., '1 day'). Defaults to '10000'.</td>
</tr>
<tr>
<td style="text-align: left;">retention_interval</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">How long/how many messages to retain before deleting old partitions. Same format as partition_interval. Defaults to '100000'.</td>
</tr>
<tr>
<td style="text-align: left;">leading_partition</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">Number of partitions to create in advance. Defaults to 10.</td>
</tr>
</tbody>
</table>
<p><strong>Note:</strong> This function renames the existing archive table to <code>&lt;table_name&gt;_old</code> and creates a new partitioned table. You may need to migrate data from the old table to the new one.</p>
<p>Example:</p>
<div class="codehilite"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">convert_archive_partitioned</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;10000&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;100000&#39;</span><span class="p">);</span>
<span class="w"> </span><span class="n">convert_archive_partitioned</span>
<span class="c1">-----------------------------</span>
</code></pre></div>

<hr />
<h3 id="detach_archive">detach_archive<a class="headerlink" href="#detach_archive" title="Permanent link">&para;</a></h3>
<p><strong> DEPRECATED:</strong> This function is deprecated and is now a no-op (does nothing). It will be removed in PGMQ v2.0. Archive tables are no longer member objects of the extension.</p>
<p>Drop the queue's archive table as a member of the PGMQ extension. Useful for preventing the queue's archive table from being drop when <code>DROP EXTENSION pgmq</code> is executed.
 This does not prevent the further archives() from appending to the archive table.</p>
<div class="codehilite"><pre><span></span><code>pgmq.detach_archive(queue_name text)
RETURNS void
</code></pre></div>

<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">queue_name</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">The name of the queue</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="codehilite"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">detach_archive</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">);</span>
<span class="w"> </span><span class="n">detach_archive</span>
<span class="c1">----------------</span>
</code></pre></div>

<hr />
<h3 id="drop_queue">drop_queue<a class="headerlink" href="#drop_queue" title="Permanent link">&para;</a></h3>
<p>Deletes a queue and its archive table.</p>
<div class="codehilite"><pre><span></span><code>pgmq.drop_queue(queue_name text)
RETURNS boolean
</code></pre></div>

<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">queue_name</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">The name of the queue</td>
</tr>
</tbody>
</table>
<p><strong>Note:</strong> There is a deprecated 2-parameter version <code>drop_queue(queue_name, partitioned)</code> that will be removed in PGMQ v2.0. Use the single-parameter version instead, which automatically detects whether the queue is partitioned.</p>
<p>Example:</p>
<div class="codehilite"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">drop_queue</span><span class="p">(</span><span class="s1">&#39;my_unlogged&#39;</span><span class="p">);</span>
<span class="w"> </span><span class="n">drop_queue</span>
<span class="c1">------------</span>
<span class="w"> </span><span class="n">t</span>
</code></pre></div>

<h2 id="utilities">Utilities<a class="headerlink" href="#utilities" title="Permanent link">&para;</a></h2>
<h3 id="set_vt-single">set_vt (single)<a class="headerlink" href="#set_vt-single" title="Permanent link">&para;</a></h3>
<p>Sets the visibility timeout of a message to a specified time duration in the future. Returns the record of the message that was updated.</p>
<div class="codehilite"><pre><span></span><code>pgmq.set_vt(queue_name text, msg_id bigint, vt integer)
pgmq.set_vt(queue_name text, msg_id bigint, vt timestamp with time zone)

RETURNS SETOF pgmq.message_record
</code></pre></div>

<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">queue_name</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">The name of the queue</td>
</tr>
<tr>
<td style="text-align: left;">msg_id</td>
<td style="text-align: left;">bigint</td>
<td style="text-align: left;">ID of the message to set visibility time</td>
</tr>
<tr>
<td style="text-align: left;">vt</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">Duration from now, in seconds, that the message's VT should be set to</td>
</tr>
<tr>
<td style="text-align: left;">vt</td>
<td style="text-align: left;">timestamp with time zone</td>
<td style="text-align: left;">Timestamp when the message becomes visible</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<p>Set the visibility timeout of message 1 to 30 seconds from now.</p>
<div class="codehilite"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">set_vt</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">);</span>
<span class="w"> </span><span class="n">msg_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">read_ct</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="n">enqueued_at</span><span class="w">          </span><span class="o">|</span><span class="w">              </span><span class="n">vt</span><span class="w">               </span><span class="o">|</span><span class="w">       </span><span class="n">message</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">headers</span>
<span class="c1">--------+---------+-------------------------------+-------------------------------+----------------------+---------</span>
<span class="w">     </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="w"> </span><span class="mi">19</span><span class="p">:</span><span class="mi">42</span><span class="p">:</span><span class="mi">21</span><span class="p">.</span><span class="mi">778741</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="w"> </span><span class="mi">19</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">34</span><span class="p">.</span><span class="mi">286462</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;hello&quot;</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;world_0&quot;</span><span class="err">}</span><span class="w"> </span><span class="o">|</span>
</code></pre></div>

<hr />
<h3 id="set_vt-batch">set_vt (batch)<a class="headerlink" href="#set_vt-batch" title="Permanent link">&para;</a></h3>
<p>Sets the visibility timeout of multiple messages to a specified time duration in the future. Returns the records of the messages that were updated.</p>
<div class="codehilite"><pre><span></span><code>pgmq.set_vt(queue_name text, msg_ids bigint[], vt integer)
pgmq.set_vt(queue_name text, msg_ids bigint[], vt timestamp with time zone)

RETURNS SETOF pgmq.message_record
</code></pre></div>

<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">queue_name</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">The name of the queue</td>
</tr>
<tr>
<td style="text-align: left;">msg_ids</td>
<td style="text-align: left;">bigint[]</td>
<td style="text-align: left;">Array of message IDs to set visibility time</td>
</tr>
<tr>
<td style="text-align: left;">vt</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">Duration from now, in seconds, that the messages' VT should be set to</td>
</tr>
<tr>
<td style="text-align: left;">vt</td>
<td style="text-align: left;">timestamp with time zone</td>
<td style="text-align: left;">Timestamp when the messages become visible</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<p>Set the visibility timeout of messages 1 and 2 to 60 seconds from now.</p>
<div class="codehilite"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">set_vt</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">ARRAY</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="mi">60</span><span class="p">);</span>
<span class="w"> </span><span class="n">msg_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">read_ct</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="n">enqueued_at</span><span class="w">          </span><span class="o">|</span><span class="w">              </span><span class="n">vt</span><span class="w">               </span><span class="o">|</span><span class="w">       </span><span class="n">message</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">headers</span>
<span class="c1">--------+---------+-------------------------------+-------------------------------+----------------------+---------</span>
<span class="w">     </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="w"> </span><span class="mi">19</span><span class="p">:</span><span class="mi">42</span><span class="p">:</span><span class="mi">21</span><span class="p">.</span><span class="mi">778741</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="w"> </span><span class="mi">19</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">34</span><span class="p">.</span><span class="mi">286462</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;hello&quot;</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;world_0&quot;</span><span class="err">}</span><span class="w"> </span><span class="o">|</span>
<span class="w">     </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="w"> </span><span class="mi">19</span><span class="p">:</span><span class="mi">42</span><span class="p">:</span><span class="mi">22</span><span class="p">.</span><span class="mi">123456</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="w"> </span><span class="mi">19</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">34</span><span class="p">.</span><span class="mi">286501</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;hello&quot;</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;world_1&quot;</span><span class="err">}</span><span class="w"> </span><span class="o">|</span>
</code></pre></div>

<hr />
<h3 id="list_queues">list_queues<a class="headerlink" href="#list_queues" title="Permanent link">&para;</a></h3>
<p>List all the queues that currently exist.</p>
<div class="codehilite"><pre><span></span><code><span class="n">pgmq</span><span class="p">.</span><span class="n">list_queues</span><span class="p">()</span>
<span class="k">RETURNS</span><span class="w"> </span><span class="k">SETOF</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">queue_record</span>
</code></pre></div>

<p>Example:</p>
<div class="codehilite"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">list_queues</span><span class="p">();</span>
<span class="w">      </span><span class="n">queue_name</span><span class="w">      </span><span class="o">|</span><span class="w">          </span><span class="n">created_at</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="n">is_partitioned</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">is_unlogged</span>
<span class="c1">----------------------+-------------------------------+----------------+-------------</span>
<span class="w"> </span><span class="n">my_queue</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="w"> </span><span class="mi">14</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">17</span><span class="p">.</span><span class="mi">092576</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">f</span><span class="w">              </span><span class="o">|</span><span class="w"> </span><span class="n">f</span>
<span class="w"> </span><span class="n">my_partitioned_queue</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="w"> </span><span class="mi">19</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">37</span><span class="p">.</span><span class="mi">098692</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">t</span><span class="w">              </span><span class="o">|</span><span class="w"> </span><span class="n">f</span>
<span class="w"> </span><span class="n">my_unlogged</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="w"> </span><span class="mi">20</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">30</span><span class="p">.</span><span class="mi">976109</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">f</span><span class="w">              </span><span class="o">|</span><span class="w"> </span><span class="n">t</span>
</code></pre></div>

<hr />
<h3 id="metrics">metrics<a class="headerlink" href="#metrics" title="Permanent link">&para;</a></h3>
<p>Get metrics for a specific queue.</p>
<div class="codehilite"><pre><span></span><code>pgmq.metrics(queue_name text)
RETURNS pgmq.metrics_result
</code></pre></div>

<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">queue_name</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">The name of the queue</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Attribute</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">queue_name</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">The name of the queue</td>
</tr>
<tr>
<td style="text-align: left;">queue_length</td>
<td style="text-align: left;">bigint</td>
<td style="text-align: left;">Number of messages currently in the queue</td>
</tr>
<tr>
<td style="text-align: left;">newest_msg_age_sec</td>
<td style="text-align: left;">integer | null</td>
<td style="text-align: left;">Age of the newest message in the queue, in seconds</td>
</tr>
<tr>
<td style="text-align: left;">oldest_msg_age_sec</td>
<td style="text-align: left;">integer | null</td>
<td style="text-align: left;">Age of the oldest message in the queue, in seconds</td>
</tr>
<tr>
<td style="text-align: left;">total_messages</td>
<td style="text-align: left;">bigint</td>
<td style="text-align: left;">Total number of messages that have passed through the queue over all time</td>
</tr>
<tr>
<td style="text-align: left;">scrape_time</td>
<td style="text-align: left;">timestamp with time zone</td>
<td style="text-align: left;">The current timestamp</td>
</tr>
<tr>
<td style="text-align: left;">queue_visible_length</td>
<td style="text-align: left;">bigint</td>
<td style="text-align: left;">Number of messages currently visible (vt &lt;= now)</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="codehilite"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">metrics</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">);</span>
<span class="w"> </span><span class="n">queue_name</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">queue_length</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">newest_msg_age_sec</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">oldest_msg_age_sec</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">total_messages</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="n">scrape_time</span>
<span class="c1">------------+--------------+--------------------+--------------------+----------------+-------------------------------</span>
<span class="w"> </span><span class="n">my_queue</span><span class="w">   </span><span class="o">|</span><span class="w">           </span><span class="mi">16</span><span class="w"> </span><span class="o">|</span><span class="w">               </span><span class="mi">2445</span><span class="w"> </span><span class="o">|</span><span class="w">               </span><span class="mi">2447</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="mi">35</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="w"> </span><span class="mi">20</span><span class="p">:</span><span class="mi">23</span><span class="p">:</span><span class="mi">08</span><span class="p">.</span><span class="mi">406259</span><span class="o">-</span><span class="mi">05</span>
</code></pre></div>

<hr />
<h3 id="metrics_all">metrics_all<a class="headerlink" href="#metrics_all" title="Permanent link">&para;</a></h3>
<p>Get metrics for all existing queues.</p>
<div class="codehilite"><pre><span></span><code>pgmq.metrics_all()
RETURNS SETOF pgmq.metrics_result
</code></pre></div>

<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Attribute</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">queue_name</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">The name of the queue</td>
</tr>
<tr>
<td style="text-align: left;">queue_length</td>
<td style="text-align: left;">bigint</td>
<td style="text-align: left;">Number of messages currently in the queue</td>
</tr>
<tr>
<td style="text-align: left;">newest_msg_age_sec</td>
<td style="text-align: left;">integer | null</td>
<td style="text-align: left;">Age of the newest message in the queue, in seconds</td>
</tr>
<tr>
<td style="text-align: left;">oldest_msg_age_sec</td>
<td style="text-align: left;">integer | null</td>
<td style="text-align: left;">Age of the oldest message in the queue, in seconds</td>
</tr>
<tr>
<td style="text-align: left;">total_messages</td>
<td style="text-align: left;">bigint</td>
<td style="text-align: left;">Total number of messages that have passed through the queue over all time</td>
</tr>
<tr>
<td style="text-align: left;">scrape_time</td>
<td style="text-align: left;">timestamp with time zone</td>
<td style="text-align: left;">The current timestamp</td>
</tr>
<tr>
<td style="text-align: left;">queue_visible_length</td>
<td style="text-align: left;">bigint</td>
<td style="text-align: left;">Number of messages currently visible (vt &lt;= now)</td>
</tr>
</tbody>
</table>
<div class="codehilite"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">metrics_all</span><span class="p">();</span>
<span class="w">      </span><span class="n">queue_name</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">queue_length</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">newest_msg_age_sec</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">oldest_msg_age_sec</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">total_messages</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="n">scrape_time</span>
<span class="c1">----------------------+--------------+--------------------+--------------------+----------------+-------------------------------</span>
<span class="w"> </span><span class="n">my_queue</span><span class="w">             </span><span class="o">|</span><span class="w">           </span><span class="mi">16</span><span class="w"> </span><span class="o">|</span><span class="w">               </span><span class="mi">2563</span><span class="w"> </span><span class="o">|</span><span class="w">               </span><span class="mi">2565</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="mi">35</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="w"> </span><span class="mi">20</span><span class="p">:</span><span class="mi">25</span><span class="p">:</span><span class="mi">07</span><span class="p">.</span><span class="mi">016413</span><span class="o">-</span><span class="mi">05</span>
<span class="w"> </span><span class="n">my_partitioned_queue</span><span class="w"> </span><span class="o">|</span><span class="w">            </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="mi">11</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="mi">11</span><span class="w"> </span><span class="o">|</span><span class="w">              </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="w"> </span><span class="mi">20</span><span class="p">:</span><span class="mi">25</span><span class="p">:</span><span class="mi">07</span><span class="p">.</span><span class="mi">016413</span><span class="o">-</span><span class="mi">05</span>
<span class="w"> </span><span class="n">my_unlogged</span><span class="w">          </span><span class="o">|</span><span class="w">            </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">                  </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w">                  </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w">              </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="w"> </span><span class="mi">20</span><span class="p">:</span><span class="mi">25</span><span class="p">:</span><span class="mi">07</span><span class="p">.</span><span class="mi">016413</span><span class="o">-</span><span class="mi">05</span>
</code></pre></div>

<hr />
<h3 id="enable_notify_insert">enable_notify_insert<a class="headerlink" href="#enable_notify_insert" title="Permanent link">&para;</a></h3>
<p>Enable PostgreSQL NOTIFY triggers for a queue with optional throttling. When enabled, a notification is sent on the channel <code>pgmq.&lt;queue_table&gt;.INSERT</code> every time a message is inserted (subject to throttling). This allows applications to use <code>LISTEN</code> to be notified immediately when new messages arrive, instead of polling.</p>
<div class="codehilite"><pre><span></span><code>pgmq.enable_notify_insert(queue_name text, throttle_interval_ms integer DEFAULT 250)
RETURNS void
</code></pre></div>

<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">queue_name</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">The name of the queue</td>
</tr>
<tr>
<td style="text-align: left;">throttle_interval_ms</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">Minimum milliseconds between notifications. Set to 0 to disable throttling. Defaults to 250.</td>
</tr>
</tbody>
</table>
<p><strong>Notes:</strong></p>
<ul>
<li>
<p>The notification channel will be named <code>pgmq.q_&lt;queue_name&gt;.INSERT</code> where <code>q_&lt;queue_name&gt;</code> is the internal table name.</p>
</li>
<li>
<p><strong>Throttling behavior</strong>: Throttling prevents excessive notifications during high-volume inserts. When multiple messages are inserted rapidly, only one notification per throttle interval will be sent. This protects your system from notification overhead when message volume is high.</p>
</li>
<li>
<p><strong>When to use notifications</strong>: Notifications are most valuable for queues with sporadic or low-volume traffic. During high-volume periods, consumers can continuously poll and expect work to be present. However, when there are longer gaps between messages, notifications allow the consumer to wait idle and only poll when it receives a notification, significantly reducing unnecessary polling overhead. The throttling feature ensures that during burst traffic, you don't create excessive notifications while still maintaining the notification behavior during low-volume periods.</p>
</li>
</ul>
<p>Examples:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">-- Enable notifications with default 250ms throttling</span>
<span class="k">select</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">enable_notify_insert</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">);</span>
<span class="w"> </span><span class="n">enable_notify_insert</span>
<span class="c1">----------------------</span>

<span class="c1">-- Enable notifications with custom 500ms throttling</span>
<span class="k">select</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">enable_notify_insert</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">500</span><span class="p">);</span>
<span class="w"> </span><span class="n">enable_notify_insert</span>
<span class="c1">----------------------</span>

<span class="c1">-- Enable notifications with no throttling (0ms)</span>
<span class="k">select</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">enable_notify_insert</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w"> </span><span class="n">enable_notify_insert</span>
<span class="c1">----------------------</span>

<span class="c1">-- In another session, listen for notifications:</span>
<span class="c1">-- LISTEN &quot;pgmq.q_my_queue.INSERT&quot;;</span>
</code></pre></div>

<p><strong>Changing throttling after enabling notifications:</strong></p>
<p>You can modify the throttling interval for an existing queue by directly updating the <code>pgmq.notify_insert_throttle</code> table:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">-- Change throttling to 1000ms (1 second)</span>
<span class="k">UPDATE</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">notify_insert_throttle</span>
<span class="k">SET</span><span class="w"> </span><span class="n">throttle_interval_ms</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">queue_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;my_queue&#39;</span><span class="p">;</span>

<span class="c1">-- Disable throttling (set to 0ms)</span>
<span class="k">UPDATE</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">notify_insert_throttle</span>
<span class="k">SET</span><span class="w"> </span><span class="n">throttle_interval_ms</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">queue_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;my_queue&#39;</span><span class="p">;</span>

<span class="c1">-- View current throttle settings for all queues</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">queue_name</span><span class="p">,</span><span class="w"> </span><span class="n">throttle_interval_ms</span><span class="p">,</span><span class="w"> </span><span class="n">last_notified_at</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">notify_insert_throttle</span><span class="p">;</span>
</code></pre></div>

<hr />
<h3 id="disable_notify_insert">disable_notify_insert<a class="headerlink" href="#disable_notify_insert" title="Permanent link">&para;</a></h3>
<p>Disable PostgreSQL NOTIFY triggers for a queue that were enabled with <code>enable_notify_insert()</code>.</p>
<div class="codehilite"><pre><span></span><code>pgmq.disable_notify_insert(queue_name text)
RETURNS void
</code></pre></div>

<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">queue_name</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">The name of the queue</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="codehilite"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">disable_notify_insert</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">);</span>
<span class="w"> </span><span class="n">disable_notify_insert</span>
<span class="c1">-----------------------</span>
</code></pre></div>

<hr />
<h3 id="create_fifo_index">create_fifo_index<a class="headerlink" href="#create_fifo_index" title="Permanent link">&para;</a></h3>
<p>Creates a GIN index on the headers column for a specific queue to improve FIFO read performance. This is recommended when using FIFO functionality frequently on a queue.</p>
<div class="codehilite"><pre><span></span><code>pgmq.create_fifo_index(queue_name text)
RETURNS void
</code></pre></div>

<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">queue_name</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">The name of the queue</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="codehilite"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">create_fifo_index</span><span class="p">(</span><span class="s1">&#39;my_queue&#39;</span><span class="p">);</span>
<span class="w"> </span><span class="n">create_fifo_index</span>
<span class="c1">-------------------</span>
</code></pre></div>

<hr />
<h3 id="create_fifo_indexes_all">create_fifo_indexes_all<a class="headerlink" href="#create_fifo_indexes_all" title="Permanent link">&para;</a></h3>
<p>Creates FIFO indexes on all existing queues. This is a convenience function to optimize all queues for FIFO operations.</p>
<div class="codehilite"><pre><span></span><code>pgmq.create_fifo_indexes_all()
RETURNS void
</code></pre></div>

<p>Example:</p>
<div class="codehilite"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="n">pgmq</span><span class="p">.</span><span class="n">create_fifo_indexes_all</span><span class="p">();</span>
<span class="w"> </span><span class="n">create_fifo_indexes_all</span>
<span class="c1">-------------------------</span>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>